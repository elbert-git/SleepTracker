var q=Object.defineProperty;var D=(l,e,t)=>e in l?q(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var a=(l,e,t)=>D(l,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const y of r.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&s(y)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();const R="https://elcloud.lol",d=class d{static onStart(){try{d.userObject=JSON.parse(localStorage.getItem(d.localStorageKey))}catch{console.log("failed to load login state"),d.userObject=null}}static async logout(){d.userObject=null,localStorage.removeItem(d.localStorageKey)}static async login(e,t){try{const s=await fetch(`${R}/sign-in`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})}),o=await s.json();return s.status===200&&localStorage.setItem(d.localStorageKey,JSON.stringify(o)),{pass:!0,body:o}}catch{return{pass:!1,error:"login failed"}}}static async appendRecord(e,t,s,o){try{if((await fetch(`${R}/append-record`,{method:"POST",headers:{Authorization:`Bearer ${d.userObject.accessToken}`,"Content-Type":"application/json"},body:JSON.stringify({nightOf:e,sleepTime:t,awakeTime:s,quality:o})})).status!==200)throw"request failed"}catch(r){alert("request failed"),console.log(r)}}};a(d,"userObject",null),a(d,"localStorageKey","sleeptracker");let f=d;const n=class n{static onStart(){var e,t;(e=document.querySelector("#loginButton"))==null||e.addEventListener("click",async()=>{const s=n.elUserNameField.value,o="P@assword123";n.elPasswordField.value="",(await f.login(s,o)).pass?window.location.href=window.location.origin:alert("authentication failed")}),(t=document.querySelector("#logoutButton"))==null||t.addEventListener("click",async()=>{f.logout(),window.location.reload()})}static setVisible(e){console.log("setting visible",e),e?n.elLoginRoot.classList.remove("none"):n.elLoginRoot.classList.add("none")}static showLogoutButton(e){e?(n.elLoginForm.classList.add("none"),n.elLogoutButton.classList.remove("none")):(n.elLoginForm.classList.remove("none"),n.elLogoutButton.classList.add("none"))}};a(n,"elLoginRoot",document.querySelector(".login-overlay")),a(n,"elUserNameField",document.querySelector("#username")),a(n,"elPasswordField",document.querySelector("#password")),a(n,"elLoginForm",document.querySelector(".login-form")),a(n,"elLogoutButton",document.querySelector("#logoutButton"));let h=n;class v{static setMessage(e){const t=document.querySelector("#lowerDialogue");e===null||e===""||e===void 0?t==null||t.classList.add("hide"):(t==null||t.classList.remove("hide"),t.innerHTML=e)}}const c=class c{static onStart(){try{const e=localStorage.getItem(c.localStorageKey),t=JSON.parse(e);if(t===null||(c.cache={morningRecord:new Date(t.morningRecord),sleepRecord:new Date(t.sleepRecord)},c.cache===null))throw"failed to load"}catch{c.cache={sleepRecord:null,morningRecord:null},c.saveStateToDisc()}console.log("states loaded",c.cache),c.updateUI()}static updateUI(){const e=new Date().getHours()<5||new Date().getHours()>18;console.log("is night",e),c.toggleNightBG(e);const t=c.evaluateSleepRecord();e?(u.toggleMorningUI(!1),t.sleptRecently?(v.setMessage(`Slept at ${m(c.cache.sleepRecord)}`),u.toggleNightUI(!1)):u.toggleNightUI(!0)):(u.toggleNightUI(!1),t.awokeRecently?(v.setMessage(`Awoke at ${m(c.cache.morningRecord)}`),u.toggleMorningUI(!1)):u.toggleMorningUI(!0))}static saveStateToDisc(){localStorage.setItem(c.localStorageKey,JSON.stringify(c.cache))}static toggleNightBG(e){var t,s,o,r,y,S,w,L;e?((t=document.querySelector(".night-bg"))==null||t.classList.remove("none"),(s=document.querySelector(".night-fg"))==null||s.classList.remove("none"),(o=document.querySelector(".morning-bg"))==null||o.classList.add("none"),(r=document.querySelector(".moring-fg"))==null||r.classList.add("none")):((y=document.querySelector(".night-bg"))==null||y.classList.add("none"),(S=document.querySelector(".night-fg"))==null||S.classList.add("none"),(w=document.querySelector(".morning-bg"))==null||w.classList.remove("none"),(L=document.querySelector(".moring-fg"))==null||L.classList.remove("none"))}static evaluateSleepRecord(){const e={sleptRecently:!1,awokeRecently:!1};if(c.cache.morningRecord!=null||c.cache.morningRecord!=null){const t=c.cache.morningRecord.getTime()-new Date().getTime();console.log(t/(1e3*60*60)),t/(1e3*60*60)<-12||(e.awokeRecently=!0)}if(c.cache.sleepRecord!=null||c.cache.sleepRecord!=null){const t=c.cache.sleepRecord.getTime()-new Date().getTime();console.log(t/(1e3*60*60)),t/(1e3*60*60)<-12||(e.sleptRecently=!0)}return console.log(e),e}};a(c,"localStorageKey","sleepTrackerRecords"),a(c,"cache",{sleepRecord:null,morningRecord:null});let i=c;const g=class g{static onStart(){document.querySelector("#sleepButton").addEventListener("click",async()=>{g.recordSleep()});const t=document.querySelectorAll(".rating-button");for(let s=0;s<t.length;s++){const o=t[s];o.addEventListener("click",async()=>{o.disabled=!0,await g.recordAwakeAndQuality(s+1),o.disabled=!1})}}static recordSleep(){i.cache.sleepRecord=new Date,i.saveStateToDisc(),i.updateUI()}static async recordAwakeAndQuality(e){i.cache.morningRecord=new Date,i.saveStateToDisc();let t="null";(i.cache.sleepRecord!=null||i.cache.sleepRecord!=null)&&i.evaluateSleepRecord().sleptRecently&&(t=m(i.cache.sleepRecord));const s=e,o=T(),r=m(new Date);try{await f.appendRecord(o,t,r,s),i.updateUI()}catch{alert("record update failed")}}static toggleNightUI(e){var t,s;e?(t=document.querySelector(".night-overlay"))==null||t.classList.remove("none"):(s=document.querySelector(".night-overlay"))==null||s.classList.add("none")}static toggleMorningUI(e){var t,s;e?(t=document.querySelector(".morning-overlay"))==null||t.classList.remove("none"):(s=document.querySelector(".morning-overlay"))==null||s.classList.add("none")}};a(g,"localStorageKey","previousSleep"),a(g,"lastNightThreshold",14),a(g,"previosSleepRecord"),a(g,"previousAwakeRecord");let u=g;function m(l){const e=l.getHours().toString().padStart(2,"0"),t=l.getMinutes().toString().padStart(2,"0");return`${e}:${t}`}function T(){const l=new Date,e=new Date(l);e.setDate(l.getDate()-1);const t=e.getFullYear().toString().slice(-2),s=(e.getMonth()+1).toString().padStart(2,"0"),o=e.getDate().toString().padStart(2,"0");return`${t}/${s}/${o}`}f.onStart();const p=f.userObject!==null;console.log("logged in",p);h.onStart();h.setVisible(!p);h.showLogoutButton(p);const b=new URLSearchParams(window.location.search),O=b.get("login")==="";h.showLogoutButton(O);i.onStart();u.onStart();document.querySelector(".time").innerHTML=m(new Date);setInterval(()=>{document.querySelector(".time").innerHTML=m(new Date)},1e3);
